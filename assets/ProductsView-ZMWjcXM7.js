import{h as U,i as _,m as v,b as w,_ as C,r as g,o as p,g as E,w as I,a as e,d as l,j as k,v as q,f as i,c as h,k as V,l as N,n as S,F as P,t as b}from"./index-qayApygg.js";import{l as D}from"./loadingStore-plWF4mFx.js";import{P as F}from"./PageC-Gqge4VsY.js";const $=U("productModalDefineStore",{state:()=>({isShow:!1,tempProduct:{}}),actions:{addImagesUrl(t){t===null?this.toast("error","請填寫圖片連結"):this.tempProduct.imagesUrl.push(t)},uploadImageUrl(){const t=new FormData,o=document.querySelector("#fileInput").files[0];t.append("file-to-upload",o),_.post("https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/upload",t).then(r=>{r.status===200&&(this.tempProduct.imageUrl=r.data.imageUrl,this.toast("success","上傳成功"))}).catch(r=>console.error("api-uploadImageUrl error",r))}}}),d=$(),m=D(),y=U("productsDefineStore",{state:()=>({products:[],pagination:{},sort:[],isEdit:!1}),actions:{getProducts(t=1){m.isLoading=!0;const o=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/products?page=${t}`;_.get(o).then(a=>{m.isLoading=!1,a.data.success?(this.products=a.data.products,this.pagination=a.data.pagination):this.toast("error","請重新登入")}).catch(()=>this.toast("error","資料取得失敗，請重新登入"))},sortNumber(t){this.products.sort((o,a)=>o[t]>a[t]?1:-1)},sortPrice(t){this.products.sort((o,a)=>o[t]-a[t])},hideModal(){d.isShow=!1},getProduct(t,o){d.isShow=!0,this.isEdit=t,this.isEdit?(d.tempProduct={...o},d.tempProduct.imagesUrl===void 0&&(d.tempProduct.imagesUrl=[])):d.tempProduct={imagesUrl:[],is_enabled:0,image:""}},updateProduct(){m.isLoading=!0;let t="post",o="https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/product";this.isEdit===!0&&(t="put",o=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/product/${d.tempProduct.id}`),delete d.tempProduct.image,_[t](o,{data:d.tempProduct}).then(a=>{m.isLoading=!1,a.data.success?(this.toast("success","上傳成功"),d.isShow=!1,this.getProducts()):this.toast("error","上傳失敗")}).catch(a=>console.error("api-updateProduct error",a))},updateEnabled(t,o){this.isEdit=t,o.is_enabled===1?o.is_enabled=0:o.is_enabled=1,d.tempProduct={...o},this.updateProduct()},removeProduct(t){const o=`https://vue3-course-api.hexschool.io/api/rongapi/admin/product/${t}`;this.alert().then(a=>{a.isConfirmed&&(m.isLoading=!0,_.delete(o).then(r=>{m.isLoading=!1,r.data.success?(this.toast("success","刪除成功"),this.getProducts()):this.toast("error","刪除失敗")}).catch(r=>console.error("api-removeProduct error",r)))})}}}),L={methods:{...v($,["uploadImageUrl","addImagesUrl"]),...v(y,["hideModal","updateProduct"])},computed:{...w($,["isShow","tempProduct"])}},j={class:"modal d-block",tabindex:"-1"},B={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},T={class:"modal-content"},A={class:"modal-header"},z=e("ul",{class:"nav nav-pills",id:"pills-tab",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," 商品內容 ")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link",id:"pills-contact-tab","data-bs-toggle":"pill","data-bs-target":"#pills-contact",type:"button",role:"tab","aria-controls":"pills-contact","aria-selected":"false"}," 上傳圖片 ")])],-1),G={class:"modal-body overflow-auto"},H={class:"container"},J={class:"tab-content",id:"pills-tabContent"},K={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab"},O={class:"mb-3"},Q=e("label",{for:"title",class:"form-label"},[i("標題"),e("span",{class:"text-danger"},"*")],-1),R={class:"row"},W={class:"mb-3 col-md-6"},X=e("label",{for:"category",class:"form-label"},[i("分類"),e("span",{class:"text-danger"},"*")],-1),Y={class:"mb-3 col-md-6"},Z=e("label",{for:"unit",class:"form-label"},[i("單位"),e("span",{class:"text-danger"},"*")],-1),ee={class:"row"},te={class:"mb-3 col-md-6"},oe=e("label",{for:"origin_price",class:"form-label"},[i("原價"),e("span",{class:"text-danger"},"*")],-1),se={class:"mb-3 col-md-6"},le=e("label",{for:"price",class:"form-label"},[i("售價"),e("span",{class:"text-danger"},"*")],-1),ae={class:"mb-3"},ne=e("label",{for:"description",class:"form-label"},[i("產品描述"),e("span",{class:"text-danger"},"*")],-1),ie={class:"mb-3"},de=e("label",{for:"content",class:"form-label"},[i("說明內容"),e("span",{class:"text-danger"},"*")],-1),re={class:"mb-3"},ce={class:"form-check"},ue=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),pe={class:"tab-pane fade",id:"pills-contact",role:"tabpanel","aria-labelledby":"pills-contact-tab"},me=e("p",null,[i("主圖"),e("span",{class:"text-danger"},"*"),i(":")],-1),he={class:"row"},be={class:"col col-md-6"},ge={class:"btn btn-outline-dark w-100",for:"fileInput"},_e={class:"col col-md-6"},fe=["src"],ve={class:"mt-5"},Pe=e("p",null,"縮圖:",-1),$e={class:"input-group mt-3"},ye={class:"d-flex overflow-auto"},ke={class:"card bg-dark text-white rounded-0 border-0"},Ve=["src"],Ue={class:"card-img-overlay text-end"},we=["onClick"],Ce=e("div",{class:"modal-footer border-0 p-0"},[e("button",{type:"submit",class:"btn btn-primary border-0 border-top w-100 m-0"}," 確認 ")],-1);function Se(t,o,a,r,x,f){const c=g("VField"),u=g("ErrorMessage"),n=g("VForm");return t.isShow?(p(),E(n,{key:0,onSubmit:t.updateProduct},{default:I(()=>[e("div",j,[e("div",B,[e("div",T,[e("div",A,[z,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:o[0]||(o[0]=(...s)=>t.hideModal&&t.hideModal(...s))})]),e("div",G,[e("div",H,[e("div",J,[e("div",K,[e("div",O,[Q,l(c,{id:"title",name:"標題",type:"text",class:"form-control",rules:"required",placeholder:"請輸入標題",modelValue:t.tempProduct.title,"onUpdate:modelValue":o[1]||(o[1]=s=>t.tempProduct.title=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"標題"})]),e("div",R,[e("div",W,[X,l(c,{id:"category",name:"分類",type:"text",class:"form-control",rules:"required",placeholder:"請輸入分類",modelValue:t.tempProduct.category,"onUpdate:modelValue":o[2]||(o[2]=s=>t.tempProduct.category=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"分類"})]),e("div",Y,[Z,l(c,{id:"unit",name:"單位",type:"text",class:"form-control",placeholder:"請輸入單位",rules:"required",modelValue:t.tempProduct.unit,"onUpdate:modelValue":o[3]||(o[3]=s=>t.tempProduct.unit=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"單位"})])]),e("div",ee,[e("div",te,[oe,l(c,{id:"origin_price",name:"原價",type:"number",min:"0",class:"form-control",rules:"required|integer|min_value:1",placeholder:"請輸入原價",modelValue:t.tempProduct.origin_price,"onUpdate:modelValue":o[4]||(o[4]=s=>t.tempProduct.origin_price=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"原價"})]),e("div",se,[le,l(c,{id:"price",name:"售價",type:"number",min:"0",class:"form-control",rules:"required|integer|min_value:1",placeholder:"請輸入售價",modelValue:t.tempProduct.price,"onUpdate:modelValue":o[5]||(o[5]=s=>t.tempProduct.price=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"售價"})])]),e("div",ae,[ne,l(c,{id:"description",type:"text",name:"描述",class:"form-control",rules:"required",as:"textarea",placeholder:"請輸入產品描述",modelValue:t.tempProduct.description,"onUpdate:modelValue":o[6]||(o[6]=s=>t.tempProduct.description=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"描述"})]),e("div",ie,[de,l(c,{id:"content",type:"text",name:"內容",class:"form-control",placeholder:"請輸入說明內容",as:"textarea",rules:"required",modelValue:t.tempProduct.content,"onUpdate:modelValue":o[7]||(o[7]=s=>t.tempProduct.content=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"內容"})]),e("div",re,[e("div",ce,[k(e("input",{id:"is_enabled",name:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=s=>t.tempProduct.is_enabled=s),"true-value":1,"false-value":0},null,512),[[q,t.tempProduct.is_enabled]]),ue])])]),e("div",pe,[me,e("div",he,[e("div",be,[e("label",ge,[i(" 上傳主圖 "),e("input",{type:"file",class:"form-control d-none",name:"file-to-upload",accept:"image/png,image/jpeg,image/jpg",id:"fileInput",placeholder:"請上傳主圖",onChange:o[9]||(o[9]=(...s)=>t.uploadImageUrl&&t.uploadImageUrl(...s))},null,32)])]),e("div",_e,[l(c,{type:"text",class:"form-control",id:"imageUrl",name:"主圖",rules:"required",placeholder:"輸入主圖連結",modelValue:t.tempProduct.imageUrl,"onUpdate:modelValue":o[10]||(o[10]=s=>t.tempProduct.imageUrl=s)},null,8,["modelValue"]),l(u,{class:"text-danger",name:"主圖"})])]),t.tempProduct.imageUrl?(p(),h("img",{key:0,class:"img-fluid mt-3",src:t.tempProduct.imageUrl,alt:"主圖"},null,8,fe)):V("",!0),e("div",ve,[Pe,e("div",$e,[k(e("input",{type:"text",name:"imagesUrl",id:"imagesUrl",class:"form-control",placeholder:"請輸入縮圖連結","onUpdate:modelValue":o[11]||(o[11]=s=>t.tempProduct.image=s)},null,512),[[N,t.tempProduct.image]]),e("button",{class:"btn btn-outline-dark",type:"button",onClick:o[12]||(o[12]=s=>t.addImagesUrl(t.tempProduct.image))}," 新增 ")]),e("div",ye,[(p(!0),h(P,null,S(t.tempProduct.imagesUrl,(s,M)=>(p(),h("div",{class:"py-3 me-2",key:s.id},[e("div",ke,[e("img",{class:"card-image",width:"150",src:s,alt:"縮圖"},null,8,Ve),e("div",Ue,[e("button",{type:"button",class:"btn-close bg-white position-absolute top-0 end-0","aria-label":"Close",onClick:st=>t.tempProduct.imagesUrl.splice(M,1)},null,8,we)])])]))),128))])])])])])]),Ce])])])]),_:1},8,["onSubmit"])):V("",!0)}const xe=C(L,[["render",Se]]),Me={inject:["currency"],components:{ProductModal:xe,PageC:F},methods:{...v(y,["getProducts","sortPrice","getProduct","updateProduct","removeProduct","sortNumber","updateEnabled"])},computed:{...w(y,["products","pagination"])},async created(){await this.getProducts()}},Ee={class:"d-flex justify-content-between align-items-center"},Ie={class:"d-flex align-items-center"},qe=e("h2",null,"產品",-1),Ne=e("span",{class:"material-symbols-outlined"},"add_circle",-1),De=[Ne],Fe={class:"table-responsive text-nowrap scrollBar-dark"},Le={class:"table mt-4"},je={class:"table-dark"},Be=e("th",null,"分類",-1),Te=e("th",null,"產品名稱",-1),Ae=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),ze=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),Ge=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),He=e("th",null,"操作",-1),Je={class:"form-check form-switch"},Ke=["checked","onChange"],Oe={class:"form-check-label pe-none",for:"flexSwitchCheckDefault"},Qe={class:"btn-group"},Re=["onClick"],We=e("span",{class:"material-symbols-outlined fs-6"},"edit",-1),Xe=[We],Ye=["onClick"],Ze=e("span",{class:"material-symbols-outlined fs-6"},"delete",-1),et=[Ze],tt={class:"d-flex justify-content-center"};function ot(t,o,a,r,x,f){const c=g("PageC"),u=g("ProductModal");return p(),h(P,null,[e("div",Ee,[e("div",Ie,[qe,e("button",{type:"button",class:"btn",onClick:o[0]||(o[0]=n=>t.getProduct(!1))},De)])]),e("div",Fe,[e("table",Le,[e("thead",null,[e("tr",je,[Be,Te,e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:o[1]||(o[1]=n=>t.sortPrice("origin_price"))},[i(" 原價"),Ae])]),e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:o[2]||(o[2]=n=>t.sortPrice("price"))},[i(" 售價"),ze])]),e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:o[3]||(o[3]=n=>t.sortNumber("is_enabled"))},[i(" 是否啟動"),Ge])]),He])]),e("tbody",null,[(p(!0),h(P,null,S(t.products,n=>(p(),h("tr",{key:n.id},[e("td",null,b(n.category),1),e("td",null,b(n.title),1),e("td",null,"NT$"+b(f.currency(n.origin_price)),1),e("td",null,"NT$"+b(f.currency(n.price)),1),e("td",null,[e("div",Je,[e("input",{class:"form-check-input",type:"checkbox",name:"isEnabled",id:"flexSwitchCheckDefault",checked:n.is_enabled,"true-value":1,"false-value":0,onChange:s=>t.updateEnabled(!0,n)},null,40,Ke),e("label",Oe,b(n.is_enabled?"啟動":"未啟動"),1)])]),e("td",null,[e("div",Qe,[e("button",{type:"button",class:"btn btn-outline-primary d-flex",onClick:s=>t.getProduct(!0,n)},Xe,8,Re),e("button",{type:"button",class:"btn btn-outline-danger d-flex",onClick:s=>t.removeProduct(n.id)},et,8,Ye)])])]))),128))])])]),e("div",tt,[l(c,{pagination:t.pagination,onPage:t.getProducts},null,8,["pagination","onPage"])]),l(u)],64)}const it=C(Me,[["render",ot]]);export{it as default};
