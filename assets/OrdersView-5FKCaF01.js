import{h as w,i as g,m as V,b as C,_ as M,r as _,o as m,g as I,w as T,a as e,d,j as k,l as A,v as U,c as b,n as L,t as i,F as v,k as F,f as c,p as j}from"./index-qayApygg.js";import{l as B}from"./loadingStore-plWF4mFx.js";import{P as E}from"./PageC-Gqge4VsY.js";const x=w("orderModalDefineStore",{state:()=>({isShow:!1,tempProduct:{user:{},products:{}},productsId:[]})}),r=x(),n=B(),$=w("ordersDefineStore",{state:()=>({orders:[],pagination:{},order:{}}),actions:{getOrders(s=1){n.isLoading=!0;const t=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/orders?page=${s}`;g.get(t).then(l=>{n.isLoading=!1,l.data.success?(this.orders=l.data.orders,this.pagination=l.data.pagination):this.toast("error","請重新登入")}).catch(l=>console.error("api-getOrders error",l))},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"},sortNumber(s){this.orders.sort((t,l)=>t[s]>l[s]?1:-1)},getOrder(s){r.isShow=!0,this.order=s,r.tempProduct={...s},r.productsId=this.orders.filter(t=>t.id===r.tempProduct.id),r.productsId=r.productsId[0].products},hideModal(){r.isShow=!1},updateOrder(){n.isLoading=!0;const s=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/order/${r.tempProduct.id}`;delete r.tempProduct.id,g.put(s,{data:r.tempProduct}).then(t=>{n.isLoading=!1,t.data.success?(this.toast("success","上傳成功"),this.getOrders(),n.isLoading=!1,r.isShow=!1):this.toast("error","上傳失敗")}).catch(t=>console.error("api-updateOrder error",t))},removeOrder(s){const t=`https://vue3-course-api.hexschool.io/api/rongapi/admin/order/${s}`;this.alert().then(l=>{l.isConfirmed&&(n.isLoading=!0,g.delete(t).then(h=>{n.isLoading=!1,h.data.success?(this.toast("success","刪除成功"),this.getOrders()):this.toast("error","刪除失敗")}).catch(h=>console.error("api-removeOrder error",h)))})},removeAllOrder(){const s="https://vue3-course-api.hexschool.io/api/rongapi/admin/orders/all";this.alert().then(t=>{t.isConfirmed&&(n.isLoading=!0,g.delete(s).then(l=>{n.isLoading=!1,l.data.success?(this.toast("success","刪除成功"),this.getOrders()):this.toast("error","刪除失敗")}).catch(l=>console.error("api-removeOrder error",l)))})}}}),q={inject:["date"],methods:{...V($,["hideModal","updateOrder","isPhone"])},computed:{...C(x,["isShow","tempProduct","productsId"])}},D={class:"modal d-block",tabindex:"-1"},H={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},z={class:"modal-content"},X={class:"modal-header"},G=e("ul",{class:"nav nav-pills",id:"pills-tab",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," 訂單內容 ")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link",id:"pills-contact-tab","data-bs-toggle":"pill","data-bs-target":"#pills-contact",type:"button",role:"tab","aria-controls":"pills-contact","aria-selected":"false"}," 商品內容 ")])],-1),J={class:"modal-body"},K={class:"container"},Q={class:"tab-content",id:"pills-tabContent"},R={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab"},W={class:"row"},Y={class:"mb-3 col-md-6"},Z=e("label",{for:"name",class:"form-label"},[c("姓名"),e("span",{class:"text-danger"},"*")],-1),ee={class:"mb-3 col-md-6"},se=e("label",{for:"phone",class:"form-label"},[c("電話"),e("span",{class:"text-danger"},"*")],-1),te={class:"row"},oe={class:"mb-3 col-md-6"},ae=e("label",{for:"email",class:"form-label"},[c("EMAIL"),e("span",{class:"text-danger"},"*")],-1),le={class:"mb-3 col-md-6"},re=e("label",{for:"create_at",class:"form-label"},[c("建立時間"),e("span",{class:"text-danger"},"*")],-1),de=["value"],ne={class:"mb-3"},ie=e("label",{for:"address",class:"form-label"},[c("地址"),e("span",{class:"text-danger"},"*")],-1),ce={class:"mb-3"},ue=e("label",{for:"message",class:"form-label"},"留言",-1),pe={class:"mb-3"},me={class:"form-check"},he=e("label",{class:"form-check-label",for:"is_enabled"},"是否已付款",-1),_e={class:"tab-pane fade",id:"pills-contact",role:"tabpanel","aria-labelledby":"pills-contact-tab"},be={class:"col"},fe=["src"],ge={class:"col"},ve={class:"pt-4 pt-lg-0"},$e=["innerHTML"],ye=["innerHTML"],Pe=e("div",{class:"modal-footer border-0 p-0"},[e("button",{type:"submit",class:"btn btn-primary border-0 border-top w-100 m-0"}," 確認 ")],-1);function Oe(s,t,l,h,S,f){const u=_("VField"),p=_("ErrorMessage"),a=_("VForm");return s.isShow?(m(),I(a,{key:0,onSubmit:s.updateOrder},{default:T(()=>[e("div",D,[e("div",H,[e("div",z,[e("div",X,[G,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...o)=>s.hideModal&&s.hideModal(...o))})]),e("div",J,[e("div",K,[e("div",Q,[e("div",R,[e("div",W,[e("div",Y,[Z,d(u,{id:"name",name:"姓名",type:"text",rules:"required",class:"form-control",placeholder:"請輸入收件者姓名",modelValue:s.tempProduct.user.name,"onUpdate:modelValue":t[1]||(t[1]=o=>s.tempProduct.user.name=o)},null,8,["modelValue"]),d(p,{class:"text-danger",name:"姓名"})]),e("div",ee,[se,d(u,{id:"phone",name:"電話",type:"text",rules:s.isPhone,class:"form-control",placeholder:"請輸入收件者電話",modelValue:s.tempProduct.user.tel,"onUpdate:modelValue":t[2]||(t[2]=o=>s.tempProduct.user.tel=o)},null,8,["rules","modelValue"]),d(p,{class:"text-danger",name:"電話"})])]),e("div",te,[e("div",oe,[ae,d(u,{id:"email",name:"email",type:"text",rules:"required|email",class:"form-control",placeholder:"請輸入收件者EMAIL",modelValue:s.tempProduct.user.email,"onUpdate:modelValue":t[3]||(t[3]=o=>s.tempProduct.user.email=o)},null,8,["modelValue"]),d(p,{class:"text-danger",name:"email"})]),e("div",le,[re,e("input",{id:"create_at",name:"create_at",type:"date",class:"form-control opacity-50",value:f.date(s.tempProduct.create_at),disabled:""},null,8,de)])]),e("div",ne,[ie,d(u,{id:"address",name:"地址",type:"text",rules:"required",class:"form-control",placeholder:"請輸入收件者地址",modelValue:s.tempProduct.user.address,"onUpdate:modelValue":t[4]||(t[4]=o=>s.tempProduct.user.address=o)},null,8,["modelValue"]),d(p,{class:"text-danger",name:"地址"})]),e("div",ce,[ue,k(e("textarea",{id:"message",type:"text",name:"message",class:"form-control",placeholder:"請輸入想對廠商說的話","onUpdate:modelValue":t[5]||(t[5]=o=>s.tempProduct.message=o)},`\r
                    `,512),[[A,s.tempProduct.message]])]),e("div",pe,[e("div",me,[k(e("input",{id:"is_enabled",name:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=o=>s.tempProduct.is_paid=o),"true-value":!0,"false-value":!1},null,512),[[U,s.tempProduct.is_paid]]),he])])]),e("div",_e,[(m(!0),b(v,null,L(s.productsId,o=>(m(),b("div",{class:"row row-cols-1 row-cols-lg-2 py-3",key:o.id},[e("div",be,[e("img",{class:"img-fluid mt-3",src:o.product.imageUrl,alt:"主圖"},null,8,fe)]),e("div",ge,[e("h5",ve,i(o.product.title),1),e("p",null,i(o.qty)+" X NT$"+i(o.product.price),1),e("p",{innerHTML:o.product.content},null,8,$e),e("p",{innerHTML:o.product.description},null,8,ye)])]))),128))])])])]),Pe])])])]),_:1},8,["onSubmit"])):F("",!0)}const ke=M(q,[["render",Oe]]),we={inject:["date","currency"],components:{OrderModal:ke,PageC:E},methods:{...V($,["getOrders","sortNumber","getOrder","removeOrder","removeAllOrder"])},computed:{...C($,["orders","pagination"])},async created(){await this.getOrders()}},Ve={class:"d-flex justify-content-between align-items-end"},Ce={class:"d-flex"},Me=e("h2",null,"訂單",-1),Le=e("span",{class:"material-symbols-outlined"},"remove_circle",-1),xe=[Le],Se={class:"text-end"},Ne={class:"m-0"},Ie={class:"table-responsive text-nowrap scrollBar-dark"},Te={class:"table mt-4"},Ae={class:"table-dark"},Ue=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),Fe=e("th",null,"姓名",-1),je=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),Be=e("th",null,"備註",-1),Ee=e("th",null,"操作",-1),qe={class:"btn-group"},De=e("span",{class:"material-symbols-outlined fs-6"},"payments",-1),He=[De],ze=["href"],Xe=e("span",{class:"material-symbols-outlined fs-6"},"map",-1),Ge=[Xe],Je=["href"],Ke=e("span",{class:"material-symbols-outlined fs-6"},"call",-1),Qe=[Ke],Re=["href"],We=e("span",{class:"material-symbols-outlined fs-6"},"email",-1),Ye=[We],Ze=["onClick"],es=e("span",{class:"material-symbols-outlined fs-6"},"edit",-1),ss=[es],ts=["onClick"],os=e("span",{class:"material-symbols-outlined fs-6"},"delete",-1),as=[os],ls={class:"d-flex justify-content-center"};function rs(s,t,l,h,S,f){const u=_("PageC"),p=_("OrderModal");return m(),b(v,null,[e("div",Ve,[e("div",Ce,[Me,e("button",{type:"button",class:"btn",onClick:t[0]||(t[0]=(...a)=>s.removeAllOrder&&s.removeAllOrder(...a))},xe)]),e("div",Se,[e("p",Ne,"總 "+i(s.orders.length)+" 筆數",1)])]),e("div",Ie,[e("table",Te,[e("thead",null,[e("tr",Ae,[e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:t[1]||(t[1]=a=>s.sortNumber("create_at"))},[c(" 建立時間"),Ue])]),Fe,e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:t[2]||(t[2]=a=>s.sortNumber("total"))},[c(" 金額"),je])]),Be,Ee])]),e("tbody",null,[(m(!0),b(v,null,L(s.orders,a=>{var o,y,P,O;return m(),b("tr",{key:a.id},[e("td",null,i(f.date(a.create_at)),1),e("td",null,i((o=a.user)==null?void 0:o.name),1),e("td",null,"NT$"+i(f.currency(a.total)),1),e("td",null,i(a.message===void 0?"無":a.message),1),e("td",null,[e("div",qe,[e("button",{type:"button",class:j(["btn btn-outline-primary d-flex pe-none",{"btn-secondary":a.is_paid}])},He,2),e("a",{href:`https://www.google.com/maps/place/${(y=a.user)==null?void 0:y.address}`,class:"btn btn-outline-primary d-flex",target:"_"},Ge,8,ze),e("a",{href:`tel:${(P=a.user)==null?void 0:P.tel}`,class:"btn btn-outline-primary d-flex"},Qe,8,Je),e("a",{href:`mailto:${(O=a.user)==null?void 0:O.email}`,class:"btn btn-outline-primary d-flex"},Ye,8,Re),e("button",{type:"button",class:"btn btn-outline-primary d-flex",onClick:N=>s.getOrder(a)},ss,8,Ze),e("button",{type:"button",class:"btn btn-outline-danger d-flex",onClick:N=>s.removeOrder(a.id)},as,8,ts)])])])}),128))])])]),e("div",ls,[d(u,{pagination:s.pagination,onPage:s.getOrders},null,8,["pagination","onPage"])]),d(p)],64)}const cs=M(we,[["render",rs]]);export{cs as default};
