import{h as V,i as _,m as f,b as C,_ as S,r as g,o as u,g as E,w as L,a as t,d as n,j as v,l as N,c as b,n as M,f as d,t as h,F as $,v as x,k as P}from"./index-mu51tG_s.js";import{l as D}from"./loadingStore-gpJfIxla.js";import{d as w,a as j}from"./filter-F1s3yoof.js";import{P as F}from"./PageC-vujmdUlz.js";const y=V("postModalDefineStore",{state:()=>({isShow:!1,tempArticles:{}}),actions:{addTag(e){e===null?this.toast("error","請填寫標籤內容"):this.tempArticles.tag.push(e)},uploadImageUrl(){const e=new FormData,s=document.querySelector("#fileInput").files[0];e.append("file-to-upload",s),_.post("https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/upload",e).then(r=>{r.status===200&&(this.tempArticles.image=r.data.imageUrl,this.toast("success","上傳成功"))}).catch(()=>this.toast("error","上傳失敗"))}}}),l=y(),m=D(),k=V("postsDefineStore",{state:()=>({articles:[],pagination:{},sort:[],isEdit:!1}),actions:{getPosts(e=1){m.isLoading=!0;const s=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/articles?page=${e}`;_.get(s).then(i=>{m.isLoading=!1,i.data.success?(this.articles=i.data.articles,this.pagination=i.data.pagination):this.toast("error","請重新登入")}).catch(()=>this.toast("error","資料取得失敗，請重新登入"))},sortNumber(e){this.articles.sort((s,i)=>s[e]>i[e]?1:-1)},hideModal(){l.isShow=!1},getPost(e,s){l.isShow=!0,this.isEdit=e,this.isEdit?(l.tempArticles={...s},l.tempArticles.create_at=w(l.tempArticles.create_at),l.tempArticles.tag===void 0&&(l.tempArticles.tag=[])):l.tempArticles={tag:[],isPublic:!1,tagItem:""}},updatePost(){m.isLoading=!0;let e="post",s="https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/article";this.isEdit===!0&&(e="put",s=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/article/${l.tempArticles.id}`),l.tempArticles.content="無",delete l.tempArticles.tagItem;const i={...l.tempArticles};i.create_at=j(i.create_at),_[e](s,{data:i}).then(r=>{m.isLoading=!1,r.data.success?(this.toast("success","上傳成功"),l.isShow=!1,this.getPosts()):this.toast("error","上傳失敗")}).catch(()=>this.toast("error","上傳失敗"))},updateEnabled(e,s){this.isEdit=e,l.tempArticles={...s},l.tempArticles.create_at=w(l.tempArticles.create_at),this.updatePost()},removePost(e){m.isLoading=!0;const s=`https://vue3-course-api.hexschool.io/api/rongapi/admin/article/${e}`;this.alert().then(i=>{i.isConfirmed&&_.delete(s).then(r=>{m.isLoading=!1,r.data.success?(this.toast("success","刪除成功"),this.getPosts()):this.toast("error","刪除失敗")}).catch(()=>this.toast("error","刪除失敗"))})}}}),T={methods:{...f(k,["hideModal","updatePost"]),...f(y,["addTag","uploadImageUrl"])},computed:{...C(y,["isShow","tempArticles"])}},q={class:"modal d-block",tabindex:"-1"},B={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},H={class:"modal-content"},z={class:"modal-header"},G=t("ul",{class:"nav nav-pills",id:"pills-tab",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link active",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," 貼文內容 ")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"pills-contact-tab","data-bs-toggle":"pill","data-bs-target":"#pills-contact",type:"button",role:"tab","aria-controls":"pills-contact","aria-selected":"false"}," 上傳圖片 ")])],-1),J={class:"modal-body"},K={class:"container"},O={class:"tab-content",id:"pills-tabContent"},Q={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab"},R={class:"mb-3"},W=t("label",{for:"title",class:"form-label"},[d("標題"),t("span",{class:"text-danger"},"*")],-1),X={class:"row"},Y={class:"mb-3 col-md-6"},Z=t("label",{for:"author",class:"form-label"},[d("作者"),t("span",{class:"text-danger"},"*")],-1),tt={class:"mb-3 col-md-6"},et=t("label",{for:"create_at",class:"form-label"},[d("建立時間"),t("span",{class:"text-danger"},"*")],-1),st={class:"mb-3"},ot=t("p",null,"標籤",-1),at={class:"input-group mt-3"},lt={class:"d-flex overflow-auto"},it={class:"badge bg-primary d-flex justify-content-between align-items-center"},nt=["onClick"],dt={class:"mb-3"},rt=t("label",{for:"description",class:"form-label"},[d("貼文描述"),t("span",{class:"text-danger"},"*")],-1),ct={class:"mb-3"},pt={class:"form-check"},ut=t("label",{class:"form-check-label",for:"isPublic"},"是否公開",-1),mt={class:"tab-pane fade",id:"pills-contact",role:"tabpanel","aria-labelledby":"pills-contact-tab"},ht=t("p",null,[d("主圖"),t("span",{class:"text-danger"},"*"),d(":")],-1),bt={class:"row"},gt={class:"col col-md-6"},_t={class:"btn btn-outline-dark w-100",for:"fileInput"},ft={class:"col col-md-6"},vt=["src"],$t=t("div",{class:"modal-footer border-0 p-0"},[t("button",{type:"submit",class:"btn btn-primary border-0 border-top w-100 m-0"}," 確認 ")],-1);function yt(e,s,i,r,U,A){const c=g("VField"),p=g("ErrorMessage"),a=g("VForm");return e.isShow?(u(),E(a,{key:0,onSubmit:e.updatePost},{default:L(()=>[t("div",q,[t("div",B,[t("div",H,[t("div",z,[G,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[0]||(s[0]=(...o)=>e.hideModal&&e.hideModal(...o))})]),t("div",J,[t("div",K,[t("div",O,[t("div",Q,[t("div",R,[W,n(c,{id:"title",name:"標題",type:"text",class:"form-control",rules:"required",placeholder:"請輸入標題",modelValue:e.tempArticles.title,"onUpdate:modelValue":s[1]||(s[1]=o=>e.tempArticles.title=o)},null,8,["modelValue"]),n(p,{class:"text-danger",name:"標題"})]),t("div",X,[t("div",Y,[Z,n(c,{id:"author",name:"作者",type:"text",rules:"required",class:"form-control",placeholder:"請輸入作者",modelValue:e.tempArticles.author,"onUpdate:modelValue":s[2]||(s[2]=o=>e.tempArticles.author=o)},null,8,["modelValue"]),n(p,{class:"text-danger",name:"作者"})]),t("div",tt,[et,n(c,{id:"create_at",name:"建立時間",type:"date",rules:"required",class:"form-control",placeholder:"請輸入建立時間",modelValue:e.tempArticles.create_at,"onUpdate:modelValue":s[3]||(s[3]=o=>e.tempArticles.create_at=o)},null,8,["modelValue"]),n(p,{class:"text-danger",name:"建立時間"})])]),t("div",st,[ot,t("div",at,[v(t("input",{type:"text",name:"tag",id:"tag",class:"form-control",placeholder:"請輸入標籤內容","onUpdate:modelValue":s[4]||(s[4]=o=>e.tempArticles.tagItem=o)},null,512),[[N,e.tempArticles.tagItem]]),t("button",{class:"btn btn-outline-dark",type:"button",onClick:s[5]||(s[5]=o=>e.addTag(e.tempArticles.tagItem))}," 新增 ")]),t("div",lt,[(u(!0),b($,null,M(e.tempArticles.tag,(o,I)=>(u(),b("div",{class:"py-3 me-2",key:o.id},[t("span",it,[d(h(o)+" ",1),t("button",{class:"btn-close btn-close-white ms-2",type:"button",onClick:ee=>e.tempArticles.tag.splice(I,1)},null,8,nt)])]))),128))])]),t("div",dt,[rt,n(c,{as:"textarea",id:"description",type:"text",name:"描述",class:"form-control",rules:"required",placeholder:"請輸入貼文描述",modelValue:e.tempArticles.description,"onUpdate:modelValue":s[6]||(s[6]=o=>e.tempArticles.description=o)},null,8,["modelValue"]),n(p,{class:"text-danger",name:"描述"})]),t("div",ct,[t("div",pt,[v(t("input",{id:"isPublic",name:"isPublic",class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=o=>e.tempArticles.isPublic=o),"true-value":!0,"false-value":!1},null,512),[[x,e.tempArticles.isPublic]]),ut])])]),t("div",mt,[ht,t("div",bt,[t("div",gt,[t("label",_t,[d(" 上傳主圖 "),t("input",{type:"file",class:"form-control d-none",name:"file-to-upload",accept:"image/png,image/jpeg,image/jpg",id:"fileInput",placeholder:"請上傳主圖",onChange:s[8]||(s[8]=(...o)=>e.uploadImageUrl&&e.uploadImageUrl(...o))},null,32)])]),t("div",ft,[n(c,{type:"text",class:"form-control",id:"image",name:"主圖",rules:"required",placeholder:"輸入主圖連結",modelValue:e.tempArticles.image,"onUpdate:modelValue":s[9]||(s[9]=o=>e.tempArticles.image=o)},null,8,["modelValue"]),n(p,{class:"text-danger",name:"主圖"})])]),e.tempArticles.image?(u(),b("img",{key:0,class:"img-fluid mt-3",src:e.tempArticles.image,alt:"主圖"},null,8,vt)):P("",!0)])])])]),$t])])])]),_:1},8,["onSubmit"])):P("",!0)}const kt=S(T,[["render",yt]]),At={inject:["date"],components:{PostModal:kt,PageC:F},methods:{...f(k,["getPosts","sortNumber","getPost","updateEnabled","removePost"])},computed:{...C(k,["articles","pagination"])},async created(){await this.getPosts()}},Pt={class:"d-flex justify-content-between align-items-center"},wt={class:"d-flex align-items-center"},Vt=t("h2",null,"貼文",-1),Ct=t("span",{class:"material-symbols-outlined"},"add_circle",-1),St=[Ct],Mt={class:"table-responsive text-nowrap scrollBar-dark"},xt={class:"table mt-4"},Ut={class:"table-dark"},It=t("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),Et=t("th",null,"標籤",-1),Lt=t("th",null,"圖片",-1),Nt=t("th",null,"標題",-1),Dt=t("th",null,"作者",-1),jt=t("th",null,"描述",-1),Ft=t("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),Tt=t("th",null,"操作",-1),qt=["src"],Bt={class:"text-truncate max-width-100"},Ht=["innerHTML"],zt={class:"form-check form-switch"},Gt=["onUpdate:modelValue","onChange"],Jt={class:"form-check-label pe-none",for:"flexSwitchCheckDefault"},Kt={class:"btn-group"},Ot=["onClick"],Qt=t("span",{class:"material-symbols-outlined fs-6"},"edit",-1),Rt=[Qt],Wt=["onClick"],Xt=t("span",{class:"material-symbols-outlined fs-6"},"delete",-1),Yt=[Xt],Zt={class:"d-flex justify-content-center"};function te(e,s,i,r,U,A){const c=g("PageC"),p=g("PostModal");return u(),b($,null,[t("div",Pt,[t("div",wt,[Vt,t("button",{type:"button",class:"btn",onClick:s[0]||(s[0]=a=>e.getPost(!1))},St)])]),t("div",Mt,[t("table",xt,[t("thead",null,[t("tr",Ut,[t("th",null,[t("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:s[1]||(s[1]=a=>e.sortNumber("create_at"))},[d(" 建立日期"),It])]),Et,Lt,Nt,Dt,jt,t("th",null,[t("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:s[2]||(s[2]=a=>e.sortNumber("isPublic"))},[d(" 是否公開"),Ft])]),Tt])]),t("tbody",null,[(u(!0),b($,null,M(e.articles,a=>(u(),b("tr",{key:a.id},[t("td",null,h(a.create_at===Number(a.create_at)?A.date(a.create_at):a.create_at),1),t("td",null,h(a.tag===void 0?"":String(a.tag)),1),t("td",null,[t("img",{class:"img-fluid",src:a.image,width:"150",alt:"主圖"},null,8,qt)]),t("td",null,[t("div",Bt,h(a.title),1)]),t("td",null,h(a.author),1),t("td",null,[t("div",{class:"text-truncate max-width-200",innerHTML:a.description},null,8,Ht)]),t("td",null,[t("div",zt,[v(t("input",{class:"form-check-input",type:"checkbox",name:"isEnabled",id:"flexSwitchCheckDefault","onUpdate:modelValue":o=>a.isPublic=o,"true-value":!0,"false-value":!1,onChange:o=>e.updateEnabled(!0,a)},null,40,Gt),[[x,a.isPublic]]),t("label",Jt,h(a.isPublic?"公開":"不公開"),1)])]),t("td",null,[t("div",Kt,[t("button",{type:"button",class:"btn btn-outline-primary d-flex",onClick:o=>e.getPost(!0,a)},Rt,8,Ot),t("button",{type:"button",class:"btn btn-outline-danger d-flex",onClick:o=>e.removePost(a.id)},Yt,8,Wt)])])]))),128))])])]),t("div",Zt,[n(c,{pagination:e.pagination,onPage:e.getPosts},null,8,["pagination","onPage"])]),n(p)],64)}const ie=S(At,[["render",te]]);export{ie as default};
