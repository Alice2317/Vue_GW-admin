import{h as k,i as b,m as g,b as V,_ as S,r as h,o as _,g as M,w as x,a as e,d,j as D,v as E,k as F,f as i,c as f,F as y,n as L,t as m}from"./index-30_fELIg.js";import{l as P}from"./loadingStore-4v_CStFw.js";import{d as w,a as U}from"./filter-F1s3yoof.js";import{P as B}from"./PageC-tVi07o6H.js";const C=k("couponModalDefineStore",{state:()=>({isShow:!1,tempCoupon:{},now:null}),actions:{today(){const o=new Date().getFullYear(),t=("0"+(new Date().getMonth()+1)).slice(-2),n=("0"+new Date().getDate()).slice(-2);return this.now=`${o}-${t}-${n}`,this.now}}}),l=C(),r=P(),$=k("couponsDefineStore",{state:()=>({coupons:[],coupon:{},pagination:{},isNew:!1}),actions:{getCoupons(o=1){r.isLoading=!0;const t=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/coupons?page=${o}`;b.get(t).then(n=>{n.data.success?(this.coupons=n.data.coupons,this.pagination=n.data.pagination,r.isLoading=!1):this.toast("error","請重新登入")}).catch(()=>this.toast("error","資料取得失敗，請重新登入"))},sortNumber(o){this.coupons.sort((t,n)=>t[o]>n[o]?1:-1)},getCoupon(o,t){this.isNew=o,this.isNew?(l.tempCoupon={...t},l.tempCoupon.due_date=w(l.tempCoupon.due_date)):l.tempCoupon={percent:100,is_enabled:0},l.isShow=!0},hideModal(){l.isShow=!1},updateCoupon(){r.isLoading=!0;let o="https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/coupon",t="post";this.isNew===!0&&(t="put",o=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/coupon/${l.tempCoupon.id}`);const n={...l.tempCoupon};n.due_date=U(n.due_date),b[t](o,{data:n}).then(p=>{r.isLoading=!1,p.data.success?(this.toast("success","上傳成功"),this.getCoupons(),l.isShow=!1):this.toast("error","上傳失敗")}).catch(()=>this.toast("error","上傳失敗"))},updateEnabled(o,t){this.isNew=o,t.is_enabled===1?t.is_enabled=0:t.is_enabled=1,l.tempCoupon={...t},l.tempCoupon.due_date=w(l.tempCoupon.due_date),this.updateCoupon()},removeCoupon(o){r.isLoading=!0;const t=`https://vue3-course-api.hexschool.io//v2/api/rongapi/admin/coupon/${o}`;this.alert().then(n=>{n.isConfirmed&&b.delete(t).then(p=>{r.isLoading=!1,p.data.success?(this.toast("success","刪除成功"),this.getCoupons()):this.toast("error","刪除失敗")}).catch(()=>this.toast("error","刪除失敗"))})}}}),j={methods:{...g($,["hideModal","updateCoupon"]),...g(C,["today"])},computed:{...V(C,["isShow","tempCoupon","now"])},async created(){await this.today()}},q={class:"modal d-block",tabindex:"-1"},A={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},T={class:"modal-content"},Y={class:"modal-header"},z=e("h5",{class:"modal-title"},"優惠碼",-1),G={class:"modal-body"},H={class:"container"},I={class:"row"},J={class:"mb-3 col-md-6"},K=e("label",{for:"title",class:"form-label"},[i("標題"),e("span",{class:"text-danger"},"*")],-1),O={class:"mb-3 col-md-6"},Q=e("label",{for:"code",class:"form-label"},[i("優惠碼"),e("span",{class:"text-danger"},"*")],-1),R={class:"row"},W={class:"mb-3 col-md-6"},X=e("label",{for:"percent",class:"form-label"},[i("折扣百分比"),e("span",{class:"text-danger"},"*")],-1),Z={class:"mb-3 col-md-6"},ee=e("label",{for:"due_date",class:"form-label"},[i("到期日"),e("span",{class:"text-danger"},"*")],-1),oe={class:"mb-3"},te={class:"form-check"},se=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),ne=e("div",{class:"modal-footer border-0 p-0"},[e("button",{type:"submit",class:"btn btn-primary border-0 border-top w-100 m-0"}," 確認 ")],-1);function ae(o,t,n,p,N,v){const c=h("VField"),u=h("ErrorMessage"),s=h("VForm");return o.isShow?(_(),M(s,{key:0,onSubmit:o.updateCoupon},{default:x(()=>[e("div",q,[e("div",A,[e("div",T,[e("div",Y,[z,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...a)=>o.hideModal&&o.hideModal(...a))})]),e("div",G,[e("div",H,[e("div",I,[e("div",J,[K,d(c,{id:"title",name:"標題",type:"text",rules:"required",class:"form-control",placeholder:"請輸入標題",modelValue:o.tempCoupon.title,"onUpdate:modelValue":t[1]||(t[1]=a=>o.tempCoupon.title=a)},null,8,["modelValue"]),d(u,{class:"text-danger",name:"標題"})]),e("div",O,[Q,d(c,{id:"code",name:"優惠碼",type:"text",rules:"required",class:"form-control",placeholder:"請輸入優惠碼",modelValue:o.tempCoupon.code,"onUpdate:modelValue":t[2]||(t[2]=a=>o.tempCoupon.code=a)},null,8,["modelValue"]),d(u,{class:"text-danger",name:"優惠碼"})])]),e("div",R,[e("div",W,[X,d(c,{id:"percent",name:"折扣百分比",type:"number",rules:"required|integer|between:1,10",min:"1",max:"100",class:"form-control",placeholder:"請輸入折扣百分比",modelValue:o.tempCoupon.percent,"onUpdate:modelValue":t[3]||(t[3]=a=>o.tempCoupon.percent=a)},null,8,["modelValue"]),d(u,{class:"text-danger",name:"折扣百分比"})]),e("div",Z,[ee,d(c,{id:"due_date",name:"到期日",type:"date",rules:"required",class:"form-control",min:o.now,placeholder:"請輸入到期日",modelValue:o.tempCoupon.due_date,"onUpdate:modelValue":t[4]||(t[4]=a=>o.tempCoupon.due_date=a)},null,8,["min","modelValue"]),d(u,{class:"text-danger",name:"到期日"})])]),e("div",oe,[e("div",te,[D(e("input",{id:"is_enabled",name:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=a=>o.tempCoupon.is_enabled=a),"true-value":1,"false-value":0},null,512),[[E,o.tempCoupon.is_enabled]]),se])])])]),ne])])])]),_:1},8,["onSubmit"])):F("",!0)}const le=S(j,[["render",ae]]),de={inject:["date"],components:{PageC:B,CouponModal:le},methods:{...g($,["getCoupons","getCoupon","updateEnabled","removeCoupon","sortNumber"])},computed:{...V($,["coupons","pagination"])},async created(){await this.getCoupons()}},ie={class:"d-flex justify-content-between align-items-center"},ce={class:"d-flex align-items-center"},ue=e("h2",null,"優惠卷",-1),re=e("span",{class:"material-symbols-outlined"},"add_circle",-1),pe=[re],me={class:"table-responsive text-nowrap scrollBar-dark"},he={class:"table mt-4"},_e={class:"table-dark"},be=e("th",null,"標題",-1),fe=e("th",null,"優惠碼",-1),ge=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),Ce=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),$e=e("span",{class:"material-symbols-outlined fs-6"}," sort ",-1),ve=e("th",null,"操作",-1),ye={class:"form-check form-switch"},we=["checked","onChange"],ke={class:"form-check-label pe-none",for:"flexSwitchCheckDefault"},Ve={class:"btn-group"},Se=["onClick"],Ne=e("span",{class:"material-symbols-outlined fs-6"},"edit",-1),Me=[Ne],xe=["onClick"],De=e("span",{class:"material-symbols-outlined fs-6"},"delete",-1),Ee=[De],Fe={class:"d-flex justify-content-center"};function Le(o,t,n,p,N,v){const c=h("PageC"),u=h("CouponModal");return _(),f(y,null,[e("div",ie,[e("div",ce,[ue,e("button",{type:"button",class:"btn",onClick:t[0]||(t[0]=s=>o.getCoupon(!1))},pe)])]),e("div",me,[e("table",he,[e("thead",null,[e("tr",_e,[be,fe,e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:t[1]||(t[1]=s=>o.sortNumber("percent"))},[i(" 折扣百分比"),ge])]),e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:t[2]||(t[2]=s=>o.sortNumber("due_date"))},[i(" 到期日"),Ce])]),e("th",null,[e("button",{class:"btn p-0 m-0 text-light",type:"button",onClick:t[3]||(t[3]=s=>o.sortNumber("is_enabled"))},[i(" 是否啟動"),$e])]),ve])]),e("tbody",null,[(_(!0),f(y,null,L(o.coupons,s=>(_(),f("tr",{key:s.id},[e("td",null,m(s.title),1),e("td",null,m(s.code),1),e("td",null,m(s.percent)+"%",1),e("td",null,m(s.due_date===Number(s.due_date)?v.date(s.due_date):s.due_date),1),e("td",null,[e("div",ye,[e("input",{class:"form-check-input",type:"checkbox",name:"isEnabled",id:"flexSwitchCheckDefault",checked:s.is_enabled,"true-value":1,"false-value":0,onChange:a=>o.updateEnabled(!0,s)},null,40,we),e("label",ke,m(s.is_enabled?"啟動":"未啟動"),1)])]),e("td",null,[e("div",Ve,[e("button",{type:"button",class:"btn btn-outline-primary d-flex",onClick:a=>o.getCoupon(!0,s)},Me,8,Se),e("button",{type:"button",class:"btn btn-outline-danger d-flex",onClick:a=>o.removeCoupon(s.id)},Ee,8,xe)])])]))),128))])])]),e("div",Fe,[d(c,{pagination:o.pagination,onPage:o.getCoupons},null,8,["pagination","onPage"])]),d(u)],64)}const qe=S(de,[["render",Le]]);export{qe as default};
